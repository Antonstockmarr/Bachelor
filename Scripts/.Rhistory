<<<<<<< HEAD
highTempC = c(rep(NA,n))
for (i in houselist)
{
if (hourly==TRUE)
{
tmp <- weather[(weather$ObsTime <= EndDays[i]),]
tmp <- tmp[tmp$ObsTime >= StartDays[i],]
temp <- tmp$Temperature
tempq <- data[[i]]$CoolingDegree*data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
else
{
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
temp <- day.tmp$Temperature
tempq <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
result <- PiecewiseOpti(i,temp2,tempq2,makeplot)
breakpoint[i]=result[1]
CSlope[i]=result[2]
highTempC[i]=result[3]
}
rm(temp2,tempq2,envir=parent.frame())
returnData <- data.frame(breakpoint=breakpoint,CSlope=CSlope,highTempC=highTempC)
}
plot(conf_interval,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
points(tempq~temp)
plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
points(tempq~temp)
fit <- lm(tempq ~ 1+x)
plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
newx = seq(-5,20,by = 0.05)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval="confidence",
level = 0.95)
str(conf_interval)
plot(conf_interval,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
points(tempq~temp)
bestpar <- optimize(f=newopti,c(5,20))
X <-(temp<bestpar$minimum)*(temp-bestpar$minimum)
fit <- lm(tempq ~ 1+X)
newx = seq(-5,20,by = 0.05)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval="confidence",
level = 0.95)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval="confidence",
level = 0.95)
plot(conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
points(tempq~temp)
X <-(temp<bestpar$minimum)*(temp-bestpar$minimum)
fit <- lm(tempq ~ 1+X)
newx = seq(-5,20,by = 0.05)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval="confidence",
level = 0.95)
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
conf_interval
str(conf_interval)
newx = seq(-5,20,by = 0.01)
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
newx = seq(-5,20,by = 0.1)
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
str(conf_interval)
plot(conf_interval$fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval$se.fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval$fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(conf_interval$pred,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
conf_interval$pred
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
str(conf_interval)
conf_interval <- predict(fit,se.fit=TRUE)
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
plot(newx~conf_interval,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(newx~conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(newx~conf_interval$fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
str(conf_interval$fit)
str(newx)
newx = seq(-5,20,length=151)
conf_interval <- predict(fit, newdata=data.frame(x=newx),se.fit=TRUE)
plot(newx~conf_interval$fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(newx,conf_interval$fit,ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
conf_interval[,1]
plot(newx,conf_interval[1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
str(conf_interval)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval='confidence')
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
points(tempq~temp)
T
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+X)
newx = seq(-5,20,length=151)
t<-temp
q<-tempq
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+X)
newx = seq(-5,20,length=151)
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval='confidence')
if (makeplot==TRUE)
{
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
#plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',
#  xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
}
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
newx = seq(min(t),max(t),length=length(t))
conf_interval <- predict(fit, newdata=data.frame(x=newx), interval='confidence')
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+X)
newx <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newx), interval='confidence')
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+X)
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
plot(newx,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
plot(conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
str(conf_interval)
fit <- lm(q ~ 1+X)
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
conf_interval <- predict(fit, newdata=data.frame(X=newdata), interval='confidence')
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+X)
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(X=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
if (makeplot==TRUE)
{
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
#plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',
#  xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
}
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
fit <- lm(q ~ 1+I((t<a)*(t-a))
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
if (makeplot==TRUE)
{
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
#plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',
#  xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
}
result = c(breakpoint = a,CSlope = fit$coefficients[2], highTempC = fit$coefficients[1],dimnames=NULL)
}
AnalyzeConsumption <- function(houselist,hourly=FALSE,makeplot=FALSE)
{
n = length(houselist)
breakpoint = c(rep(NA,n))
CSlope = c(rep(NA,n))
highTempC = c(rep(NA,n))
for (i in houselist)
{
if (hourly==TRUE)
{
tmp <- weather[(weather$ObsTime <= EndDays[i]),]
tmp <- tmp[tmp$ObsTime >= StartDays[i],]
temp <- tmp$Temperature
tempq <- data[[i]]$CoolingDegree*data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
else
{
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
temp <- day.tmp$Temperature
tempq <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
result <- PiecewiseOpti(i,temp2,tempq2,makeplot)
breakpoint[i]=result[1]
CSlope[i]=result[2]
highTempC[i]=result[3]
}
rm(temp2,tempq2,envir=parent.frame())
returnData <- data.frame(breakpoint=breakpoint,CSlope=CSlope,highTempC=highTempC)
}
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
X <-(t<a)*(t-a)
fit <- lm(q ~ 1+I((t<a)*(t-a))
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
if (makeplot==TRUE)
{
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
#plot((fit$coefficients[1]+fit$coefficients[2]*x)~temp,ylab='Consumption',
#  xlab='Temperature',main = paste('House number', i),col='red',type='l',ylim=c(0,max(tempq)))
}
result = c(breakpoint = a,CSlope = fit$coefficients[2], highTempC = fit$coefficients[1],dimnames=NULL)
}
AnalyzeConsumption <- function(houselist,hourly=FALSE,makeplot=FALSE)
{
n = length(houselist)
breakpoint = c(rep(NA,n))
CSlope = c(rep(NA,n))
highTempC = c(rep(NA,n))
for (i in houselist)
{
if (hourly==TRUE)
{
tmp <- weather[(weather$ObsTime <= EndDays[i]),]
tmp <- tmp[tmp$ObsTime >= StartDays[i],]
temp <- tmp$Temperature
tempq <- data[[i]]$CoolingDegree*data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
else
{
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
temp <- day.tmp$Temperature
tempq <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
# Removing NA's
assign("temp2", value = temp[!(is.na(tempq))], envir = parent.frame())
assign("tempq2", value = tempq[!(is.na(tempq))], envir = parent.frame())
}
result <- PiecewiseOpti(i,temp2,tempq2,makeplot)
breakpoint[i]=result[1]
CSlope[i]=result[2]
highTempC[i]=result[3]
}
rm(temp2,tempq2,envir=parent.frame())
returnData <- data.frame(breakpoint=breakpoint,CSlope=CSlope,highTempC=highTempC)
}
fit <- lm(q ~ 1+I((t<a)*(t-a)))
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
fit <- lm(q ~ 1+I((t<a)*(t-a)))
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
matlines(newdata,conf_interval[2,])
bestpar <- optimize(f=newopti,c(5,20))
a <- bestpar$minimum
fit <- lm(q ~ 1+I((t<a)*(t-a)))
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
matlines(newdata,conf_interval[2,])
str(newdata)
conf_interval
str(conf_interval)
matlines(newdata,conf_interval[,2])
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
matlines(newdata,conf_interval[,2])
matlines(newdata,conf_interval[,2],col="green",lwd=0.5,lty='dashed')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
matlines(newdata,conf_interval[,2],col="green",lwd=0.5,lty='dashed')
matlines(newdata,conf_interval[,2],col="green",lwd=2,lty='dashed')
matlines(newdata,conf_interval[,2],col="green",lwd=1.5,lty='dashed')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
matlines(newdata,conf_interval[,2],col="green",lwd=1.5,lty='dashed')
matlines(newdata,conf_interval[,2],col="green",lwd=1,lty='dashed')
matlines(newdata,conf_interval[,3],col="green",lwd=1,lty='dashed')
rm(list=ls())
source("data.R")
source("Piecewise-opti.R")
# Plotting the first house
AnalyzeConsumption(houselist=7,hourly=FALSE,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=1,hourly=FALSE,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=36,hourly=FALSE,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=44,hourly=FALSE,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=64,hourly=FALSE,makeplot=TRUE)
# Plotting ALL houses
AnalyzeConsumption(houselist=1:n,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=52,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=15,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=36,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=15,makeplot=TRUE)
plot(data[[15]]$Volume)
k=20
plot((4.186/3.6)*data[[k]]$Volume*(data[[k]]$TemperatureIn-data[[k]]$TemperatureOut)~data[[k]]$Energy)
plot((4.186/3.6)*data[[k]]$Flow*(data[[k]]$TemperatureIn-data[[k]]$TemperatureOut)~data[[k]]$Energy)
plot(TemperatureIn-TemperatureOut~CoolingDegree,data[[1]])
sum(abs(((data[[1]]$TemperatureIn-data[[1]]$TemperatureOut)-data[[1]]$CoolingDegree)))
# 15 and 36  have periods with 0 volume
plot(data[[15]]$Volume)
plot(data[[36]]$Volume)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
par(mar=c(3,3,2,1), mgp=c(2,0.7,0))
source("data.R")
source("Piecewise-opti.R")
library(ggplot2)
# Farveeksempel
Wcol=c(1,rgb(132,202,41,maxColorValue = 255),rgb(231,176,59,maxColorValue = 255),rgb(229,56,50,maxColorValue = 255))
plot(data[[1]]$Flow,col=Wcol[2])
pairs(data[[1]])
plot(data[[1]]$Flow)
plot.months <- c("January", "February", "March", "April", "May", "June", "July", "August",
"September", "November", "December")
par(mfrow = c(1,1))
time <- seq(as.Date(StartDays[1]),as.Date(EndDays[1]), by = "1 mon")
plot(data[[1]]$StartDateTime, data[[1]]$Flow, "l", xaxt = 'n')
drawxaxis(data[[1]]$StartDateTime, tick.tstep="months")
axis.Date(1, at = seq(min(time), max(time), by = "12 mon"), format = "%m")
# Investigating each house's flow behaviour
for (i in 1:1){
#data[[i]]$StartDateTime.new <- as.POSIXlt(data[[i]]$StartDateTime)
#data[[i]]$StartDateTime <- as.Date(data[[i]]$StartDateTime, "%Y-%m-%d")
#data[[i]]$StartDateTime2 <- as.Date(cut(data[[i]]$StartDateTime, breaks = "month"))
plot(data[[i]]$StartDateTime, data[[i]]$Flow, type = "l", xlab ="Time", ylab = "Flow")
axis(1, at = unique(months(data[[i]]$StartDateTime)), las = 2)
}
# Investigating weather data
pairs(weather)
plot(weather$StartDateTime,weather$WindSpeed, type = "l")
str(weather)
plot(weather$SunHour[weather$IsHistoricalEstimated==FALSE], weather$UltravioletIndex[weather$IsHistoricalEstimated==FALSE])
# Correlation between consumption and wind
plot(tmp$WindSpeed,data[[1]]$CoolingDegree*data[[1]]$Flow)
plot(tmp$WindDirection,data[[42]]$CoolingDegree*data[[42]]$Flow)
#
ggplot(tmp, aes(x = Temperature, y= data[[1]]$CoolingDegree*data[[1]]$Flow)) +
geom_point() + geom_smooth(colour=2) + ylab("Consumption")
avgconsumption<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
weightavg<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
difftime(max(EndDays),min(StartDays), units ="hours")
avgconsumption[difftime(max(EndDays),min(StartDays), units ="hours")]
difftime(StartDays[1],min(StartDays), units ="hours")
difftime(EndDays[1],min(StartDays), units ="hours")
for (i in 1:n) {
avgconsumption[difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours")]<-
avgconsumption[difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours")]+
data[[i]]$Flow*data[[i]]$CoolingDegree
weightavg[difftime(StartDays[i]+1,min(StartDays), units ="hours"):difftime(EndDays[i]+1,min(StartDays), units ="hours")]<-
weightavg[difftime(StartDays[i]+1,min(StartDays), units ="hours"):difftime(EndDays[i]+1,min(StartDays), units ="hours")]+
rep(1,length(data[[1]]$Flow))
}
length(difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours"))
length(data[[i]]$Flow*data[[i]]$CoolingDegree)
maxskip<-rep(0,n)
sumskip<-rep(0,n)
for (i in 1:n) {
ntmp=length(data[[i]]$StartDateTime)
tmpdiftest=difftime(data[[i]]$StartDateTime[1:ntmp-1],data[[i]]$StartDateTime[2:ntmp], units ="hours")
maxskip[i]=max(tmpdiftest)
if(max(tmpdiftest)>1){
print(match(2:max(tmpdiftest),tmpdiftest))
}
}
n69=length(data[[69]]$StartDateTime)
tmpdiftest=difftime(data[[69]]$StartDateTime[1:n69-1],data[[69]]$StartDateTime[2:n69], units ="hours")
str(day.avg)
plot((4.186/3.6)*data[[k]]$Volume*(data[[k]]$TemperatureIn-data[[k]]$TemperatureOut)~data[[k]]$Energy)
plot((4.186/3.6)*data[[k]]$Flow*(data[[k]]$TemperatureIn-data[[k]]$TemperatureOut)~data[[k]]$Energy)
plot((4.186/3.6)*data[[k]]$Volume*(data[[k]]$TemperatureIn-data[[k]]$TemperatureOut)~data[[k]]$Energy)
# Plotting ALL houses
AnalyzeConsumption(houselist=1:n,makeplot=TRUE)
pairs(day.avg[c(1:7,10)])
# Weather pairs
pairs(c(day.avg[10], day.tmp[c(1:9,11)]))
# Focus on attributes from weather data
pairs(c(day.avg[10], day.tmp[c(1:2,5,7,9)]))
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
par(mar=c(3,3,2,1), mgp=c(2,0.7,0))
source("data.R")
source("Piecewise-opti.R")
library(ggplot2)
# Farveeksempel
Wcol=c(1,rgb(132,202,41,maxColorValue = 255),rgb(231,176,59,maxColorValue = 255),rgb(229,56,50,maxColorValue = 255))
plot(data[[1]]$Flow,col=Wcol[2])
pairs(data[[1]])
plot(data[[1]]$Flow)
plot.months <- c("January", "February", "March", "April", "May", "June", "July", "August",
"September", "November", "December")
par(mfrow = c(1,1))
time <- seq(as.Date(StartDays[1]),as.Date(EndDays[1]), by = "1 mon")
plot(data[[1]]$StartDateTime, data[[1]]$Flow, "l", xaxt = 'n')
drawxaxis(data[[1]]$StartDateTime, tick.tstep="months")
axis.Date(1, at = seq(min(time), max(time), by = "12 mon"), format = "%m")
# Investigating each house's flow behaviour
for (i in 1:1){
#data[[i]]$StartDateTime.new <- as.POSIXlt(data[[i]]$StartDateTime)
#data[[i]]$StartDateTime <- as.Date(data[[i]]$StartDateTime, "%Y-%m-%d")
#data[[i]]$StartDateTime2 <- as.Date(cut(data[[i]]$StartDateTime, breaks = "month"))
plot(data[[i]]$StartDateTime, data[[i]]$Flow, type = "l", xlab ="Time", ylab = "Flow")
axis(1, at = unique(months(data[[i]]$StartDateTime)), las = 2)
}
# Investigating weather data
pairs(weather)
plot(weather$StartDateTime,weather$WindSpeed, type = "l")
str(weather)
plot(weather$SunHour[weather$IsHistoricalEstimated==FALSE], weather$UltravioletIndex[weather$IsHistoricalEstimated==FALSE])
# No correlation
# Correlation between consumption and wind
plot(tmp$WindSpeed,data[[1]]$CoolingDegree*data[[1]]$Flow)
plot(tmp$WindDirection,data[[42]]$CoolingDegree*data[[42]]$Flow)
#
plot1 <- ggplot(data = dt.full, mapping = aes(day, EnergyPurchase)) + geom_point() +
ggtitle("Average consumption for all houses during a year ") + xlab("Time")
+ ylab("Average consumption (kwh)")
+ geom_smooth(col=col.plot, se = T)
avgconsumption<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
weightavg<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
difftime(max(EndDays),min(StartDays), units ="hours")
avgconsumption[difftime(max(EndDays),min(StartDays), units ="hours")]
difftime(StartDays[1],min(StartDays), units ="hours")
difftime(EndDays[1],min(StartDays), units ="hours")
for (i in 1:n) {
avgconsumption[difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours")]<-
avgconsumption[difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours")]+
data[[i]]$Flow*data[[i]]$CoolingDegree
weightavg[difftime(StartDays[i]+1,min(StartDays), units ="hours"):difftime(EndDays[i]+1,min(StartDays), units ="hours")]<-
weightavg[difftime(StartDays[i]+1,min(StartDays), units ="hours"):difftime(EndDays[i]+1,min(StartDays), units ="hours")]+
rep(1,length(data[[1]]$Flow))
}
length(difftime(StartDays[i],min(StartDays), units ="hours"):difftime(EndDays[i],min(StartDays), units ="hours"))
length(data[[i]]$Flow*data[[i]]$CoolingDegree)
maxskip<-rep(0,n)
sumskip<-rep(0,n)
for (i in 1:n) {
ntmp=length(data[[i]]$StartDateTime)
tmpdiftest=difftime(data[[i]]$StartDateTime[1:ntmp-1],data[[i]]$StartDateTime[2:ntmp], units ="hours")
maxskip[i]=max(tmpdiftest)
if(max(tmpdiftest)>1){
print(match(2:max(tmpdiftest),tmpdiftest))
}
}
n69=length(data[[69]]$StartDateTime)
tmpdiftest=difftime(data[[69]]$StartDateTime[1:n69-1],data[[69]]$StartDateTime[2:n69], units ="hours")
# Investigating pairs plots
day.tmp <- day.weather[(day.weather$Date <= as.Date(day.avg$Date[1],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(tail(day.avg$Date,1),tz="GMT"),]
pairs(day.avg[c(1:7,10)])
# Weather pairs
pairs(c(day.avg[10], day.tmp[c(1:9,11)]))
# Focus on attributes from weather data
pairs(c(day.avg[10], day.tmp[c(1:2,5,7,9)]))
pairs(day.avg[c(1:7,10)])
# Weather pairs
pairs(c(day.avg[10], day.tmp[c(1:9,11)]))
# Focus on attributes from weather data
pairs(c(day.avg[10], day.tmp[c(1:2,5,7,9)]))
?ceiling
# Plotting the first house
AnalyzeConsumption(houselist=48,makeplot=TRUE)
# Plotting the first house
AnalyzeConsumption(houselist=42,makeplot=TRUE)
=======
acftmp<-acf(dat[i,],plot=FALSE,lag.max = lm)
lines(0:lm,acftmp$acf[,1,1],col=colors[i])
}
##
plot(dat[1,],type="l")
pacf(dat[1,])
pacf1<-pacf(dat[1,],plot=FALSE,lag.max = lm)
pacf1$acf[,1,1]
plot(pacf1,xlim=c(.5,lm-2),ylim=c(-.5,1),type="l",col=1,main="Partial autocorrelation function for the 10 simulations")
for(i in 2:10){
pacftmp<-pacf(dat[i,],plot=FALSE,lag.max = lm)
lines(1:lm,pacftmp$acf[,1,1],col=i)
}
avars=rep(NA,10)
for(i in 1:10){
acftmp<-acf(dat[i,],plot=FALSE,lag.max = lm,type="covariance")
avars[i]<-acftmp$acf[1,1,1]
}
avars
acf(log(tab$NO2[train]),lag.max = 200)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("data.R")
# 64 vælges da det er godt:
str(day.data[[64]])
i=64
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
tmp.fit<-lm(q~t)
plot(tmp.fit)
plot(q~t)
(tmp.fit<-lm(q~t))
(tmp.fit<-lm(q~t))
#plot(q~t)
newdata <- seq(min(t),max(t),length=30)
conf_interval <- predict(fit, newdata=data.frame(t=newdata), interval='confidence')
conf_interval <- predict(tmp.fit, newdata=data.frame(t=newdata), interval='confidence')
plot(newdata,conf_interval[,1],ylab='Consumption',xlab='Temperature',
main = paste('House number', i),col='red',type='l',ylim=c(0,max(q)))
points(q~t)
matlines(newdata,conf_interval[,2],col="green",lwd=1,lty='dashed')
matlines(newdata,conf_interval[,3],col="green",lwd=1,lty='dashed')
tmp.fit$model
plot(tmp.fit$model)
(tmp.fit<-lm(q~t))
str(tmp.fit)
sigma(tmp.fit)
fitted.temp <- 0:max(day.weather$Temperature)
tmp.fit$coefficients[1]
tmp.fit$coefficients[2]
tmp.fit$coefficients[2]+3
?rep
plot.points <-rbind(rep(3,rep(0,length(fitted.temp)),3))
plot.points <-rbind(rep(rep(0,length(fitted.temp),3)))
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.tmp){
tmp.fit<-lm(q[t<i]~t[t<i])
plot.points[,i]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
for (i in fitted.temp){
tmp.fit<-lm(q[t<i]~t[t<i])
plot.points[,i]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(plot.points[2,])
points(plot.points[1,],col=2)
points(plot.points[3,],col=2)
plot(plot.points[2,],ylim=c(-.3,.3))
points(plot.points[1,],col=2)
points(plot.points[3,],col=2)
plot(plot.points[2,],fitted.temp,ylim=c(-.3,.3))
plot(fitted.temp,plot.points[2,],ylim=c(-.3,.3))
plot(fitted.temp,plot.points[2,])
t <- day.tmp$Temperature
str(day.data[[64]])
i=64
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<i]~t[t<i])
plot.points[,i]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,])
points(plot.points[1,],col=2)
points(plot.points[3,],col=2)
plot.points
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("data.R")
# 64 vælges da det er godt:
str(day.data[[64]])
i=64
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i-1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,])
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,])
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
plot(fitted.temp,plot.points[2,],ylim=c(-1,1))
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
plot(fitted.temp,plot.points[2,],ylim=c(-.7,1.7))
plot(fitted.temp,plot.points[2,],ylim=c(-.7,.7))
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
plot(fitted.temp,plot.points[2,],ylim=c(-1,.7))
plot(q~t)
i=68
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,],ylim=c(-1,.7))
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
i=42
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[i],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[i],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[i]]$CoolingDegree*day.data[[i]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,])#,ylim=c(-1,.7))
plot(fitted.temp,plot.points[2,],main=n)#,ylim=c(-1,.7))
k=42
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,],main=k)#,ylim=c(-1,.7))
# 68 vælges da det er godt:
if(TRUE){
k=38
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,],main=k)#,ylim=c(-1,.7))
}
points(fitted.temp,plot.points[1,],col=2)
points(fitted.temp,plot.points[3,],col=2)
# 68 vælges da det er godt:
for(k in 1:n){
if(TRUE){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- 0:max(day.weather$Temperature)
plot.points <-rbind(rep(0,length(fitted.temp)),rep(0,length(fitted.temp)),rep(0,length(fitted.temp)))
for (i in fitted.temp){
tmp.fit<-lm(q[t<=i]~t[t<=i])
plot.points[,i+1]<-tmp.fit$coefficients[2]+c(2,0,-2)*sigma(tmp.fit)
}
plot(fitted.temp,plot.points[2,],main=k)#,ylim=c(-1,.7))
}
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (min(day.tmp$Temperature)+5):max(day.tmp$Temperature)
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (min(day.tmp$Temperature)+5):max(day.tmp$Temperature)
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-min(day.tmp$Temperature)]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (min(day.tmp$Temperature)+5):max(day.tmp$Temperature)
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-fitted.temp(1)+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (min(day.tmp$Temperature)+5):max(day.tmp$Temperature)
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-fitted.temp[1]+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
t
min(t)
min(maks)
max(t)
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ciel(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-fitted.temp[1]+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceil(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-fitted.temp[1]+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[i-fitted.temp[1]+1]<-min(q.tmp)
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
(tmp.fit<-lm(q~t))
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
k=1
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-5]
plot.points[k]<-min(q.tmp)
k=k+1
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+10):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
k=1
for (i in fitted.temp){
q.tmp <- q[t<i]
q.tmp <- q.tmp[t>i-10]
plot.points[k]<-min(q.tmp)
k=k+1
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
k=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
q.tmp <- q.tmp[t>i-5]
plot.points[k]<-min(q.tmp)
obs[k]<-length(q.tmp)
k=k+1
}
plot(obs)
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
plot(obs)
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
k=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-5]
plot.points[k]<-min(q.tmp)
obs[k]<-length(q.tmp)
k=k+1
}
plot(obs)
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 44){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-5]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(obs)
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
plot(obs)
plot(plot.points,main=k)#,ylim=c(-1,.7))
for(k in 1:n){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+5):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-5]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 1:n){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+1):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-1]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 1:n){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+1):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-1]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(plot.points,fitted.temp,main=k)#,ylim=c(-1,.7))
}
for(k in 1:n){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+1):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-1]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(fitted.temp,plot.points,main=k)#,ylim=c(-1,.7))
}
for(k in 1:n){
day.tmp <- day.weather[(day.weather$Date <= as.Date(EndDays[k],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(StartDays[k],tz="GMT"),]
t <- day.tmp$Temperature
q <- day.data[[k]]$CoolingDegree*day.data[[k]]$Volume
fitted.temp <- (floor(min(day.tmp$Temperature))+2):ceiling(max(day.tmp$Temperature))
plot.points <-rep(0,length(fitted.temp))
obs <-rep(0,length(fitted.temp))
j=1
for (i in fitted.temp){
q.tmp <- q[t<=i]
t.tmp <- t[t<=i]
q.tmp <- q.tmp[t.tmp>i-2]
plot.points[j]<-min(q.tmp)
obs[j]<-length(q.tmp)
j=j+1
}
plot(fitted.temp,plot.points,main=k)#,ylim=c(-1,.7))
}
>>>>>>> 816caab8d36493f4ca62ecf13f1125ad480cef9d
