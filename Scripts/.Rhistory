}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 1   # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 1   # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 1   # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 1   # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 1   # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
plot(tv,I,type="s",xlab="Time",ylab="I")
N <- 1000  # Number of individuals in the population
I0 <- 10    # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
delta <- gamma/10
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
if(X[j] == 3)
{
if(runif(1) < delta*R[i]*dt) X[j] <- 1
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
# Comparing with deterministic model
SIRmodel2 <- function(t, y, p){
with(as.list(c(y,p)),{
dSdt <- -beta*S*I+delta*R
dIdt <- beta*S*I-gamma*I
dRdt = gamma*I
dydt <- c(dSdt, dIdt, dRdt)
return(list(dydt))
})
}
SIR_p2 <- c(beta = beta, gamma = gamma, delta = delta)
SIR_y <- c(S = S0, I = I0, R = 0)
SIRsol2 <-  as.data.frame(ode(y = SIR_y, times = tv, func = SIRmodel2, parms = SIR_p2))
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
lines(tv, SIRsol2$R, col = 2)
plot(tv,I,type="s",xlab="Time",ylab="I")
lines(tv, SIRsol2$I, col = 2)
N <- 1000  # Number of individuals in the population
I0 <- 10    # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
delta <- gamma/10
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
if(X[j] == 3)
{
if(runif(1) < delta*R[i]*dt) X[j] <- 1
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
# Comparing with deterministic model
SIRmodel2 <- function(t, y, p){
with(as.list(c(y,p)),{
dSdt <- -beta*S*I+delta*R
dIdt <- beta*S*I-gamma*I
dRdt = gamma*I-delta*R
dydt <- c(dSdt, dIdt, dRdt)
return(list(dydt))
})
}
SIR_p2 <- c(beta = beta, gamma = gamma, delta = delta)
SIR_y <- c(S = S0, I = I0, R = 0)
SIRsol2 <-  as.data.frame(ode(y = SIR_y, times = tv, func = SIRmodel2, parms = SIR_p2))
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
lines(tv, SIRsol2$R, col = 2)
plot(tv,I,type="s",xlab="Time",ylab="I")
lines(tv, SIRsol2$I, col = 2)
N <- 1000  # Number of individuals in the population
I0 <- 10    # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
delta <- gamma/10
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
if(X[j] == 3)
{
if(runif(1) < delta*R[i]*dt) X[j] <- 1
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
# Comparing with deterministic model
SIRmodel2 <- function(t, y, p){
with(as.list(c(y,p)),{
dSdt <- -beta*S*I+delta*R
dIdt <- beta*S*I-gamma*I
dRdt = gamma*I-delta*R
dydt <- c(dSdt, dIdt, dRdt)
return(list(dydt))
})
}
SIR_p2 <- c(beta = beta, gamma = gamma, delta = delta)
SIR_y <- c(S = S0, I = I0, R = 0)
SIRsol2 <-  as.data.frame(ode(y = SIR_y, times = tv, func = SIRmodel2, parms = SIR_p2))
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
lines(tv, SIRsol2$R, col = 2)
plot(tv,I,type="s",xlab="Time",ylab="I")
lines(tv, SIRsol2$I, col = 2)
N <- 1000  # Number of individuals in the population
I0 <- 10    # Initial number of infected
S0 <- N-I0 # Vi har ikke recovered endnu, så det er N pr. de syge
## Define state vector
X <- rep(1,N) # "1" codes "susceptible", "2" codes "infected", "3" codes "recovered"
X[1:I0] <- 2
## Model parameters
gamma <- 1
R_0 <- 2
beta <- (R_0*gamma)/S0 # Udtryk for R0 og isolere beta
delta <- gamma/10
## Simulation parameters
T <- floor(365/2)
dt <- (T/24)/30
nt <- T/dt
tv <- seq(0,T,dt)
## Output
S <- I <- R <- numeric(nt+1)
S[1] <- sum(X == 1)
I[1] <- sum(X == 2)
R[1] <- sum(X == 3)
## Main loop
for(i in 1:nt)
{
for(j in 1:N)
{
if(X[j] == 2) ## Let each "Infected" "Recover" with probability gamma*dt
{
if(runif(1) < gamma*dt) X[j] <- 3
}
if(X[j] == 1)
{
if(runif(1) < beta*I[i]*dt) X[j] <- 2
}
if(X[j] == 3)
{
if(runif(1) < delta*dt) X[j] <- 1
}
}
S[i+1] <- sum(X == 1)
I[i+1] <- sum(X == 2)
R[i+1] <- sum(X == 3)
}
# Comparing with deterministic model
SIRmodel2 <- function(t, y, p){
with(as.list(c(y,p)),{
dSdt <- -beta*S*I+delta*R
dIdt <- beta*S*I-gamma*I
dRdt = gamma*I-delta*R
dydt <- c(dSdt, dIdt, dRdt)
return(list(dydt))
})
}
SIR_p2 <- c(beta = beta, gamma = gamma, delta = delta)
SIR_y <- c(S = S0, I = I0, R = 0)
SIRsol2 <-  as.data.frame(ode(y = SIR_y, times = tv, func = SIRmodel2, parms = SIR_p2))
## Plots
par(mfrow=c(1,2))
plot(tv,S,type="s",ylim=c(0,N),xlab="Time",ylab="S,R")
lines(tv,R,type="s")
lines(tv, SIRsol2$R, col = 2)
plot(tv,I,type="s",xlab="Time",ylab="I")
lines(tv, SIRsol2$I, col = 2)
Istar <- 45.90909 # sidste entry fra I fra ode solution
Sstar <- gamma/beta
J <- matrix(c(-beta*Istar-delta, -beta*Sstar-delta, Istar*beta, 0), nrow = 2, byrow = TRUE)
eigen(J)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
par(mar=c(3,3,2,1), mgp=c(2,0.7,0))
source("data.R")
source("BBR.R")
library(ggplot2)
library(gridExtra)
library(tidyverse)
# Watts colors
Wcol=c(1,rgb(132,202,41,maxColorValue = 255),rgb(231,176,59,maxColorValue = 255),rgb(229,56,50,maxColorValue = 255))
# Example using Watts colors
plot(data[[1]]$Flow,col=Wcol[2])
avgconsumption<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
weightavg<-rep(0,difftime(max(EndDays),min(StartDays), units ="hours"))
difftime(max(EndDays),min(StartDays), units ="hours")
avgconsumption[difftime(max(EndDays),min(StartDays), units ="hours")]
difftime(StartDays[1],min(StartDays), units ="hours")
difftime(EndDays[1],min(StartDays), units ="hours")
# Investigating pairs plots
day.tmp <- day.weather[(day.weather$Date <= as.Date(day.avg$Date[1],tz="GMT")),]
day.tmp <- day.tmp[day.tmp$Date >= as.Date(tail(day.avg$Date,1),tz="GMT"),]
?ggpairs
# Sun pairs
GGally::ggpairs(day.weather[c('SunHour','Condition','Radiation')])
# Possible multicolinarity between Temperature and DewPoint
cor(day.tmp['Temperature'],day.tmp['DewPoint'])
